<launch>

    <arg name="bag_file_use" default="true" />
    <arg name="config_file" default="$(find mloam)/../config/config_handheld.yaml" />

    <arg name="run_mloam" default="true" />
    <arg name="run_aloam" default="false" />
    <arg name="run_legoloam" default="false" />

    <arg name="run_mloam_map_with_up" default="true" /> <!-- uncertainty propagation -->    
    <arg name="mloam_result_save" default="1" />
    
    <arg name="output_path" default="/home/jjiao/trajectory_results/handheld/test/mloam_20200303/RHD03building/"/>
    <arg name="mloam_gt_path" default="stamped_groundtruth.txt" />    
    <arg name="mloam_odom_path" default="stamped_mloam_odom_estimate.txt" />
    <arg name="mloam_map_path" default="stamped_mloam_map_estimate.txt" /> 
    <arg name="mloam_map_wo_up_path" default="stamped_mloam_map_wo_up_estiamte.txt" /> 

    <param name="use_sim_time" value="true" />

    <!-- Ros Bag -->
    <group if="$(arg bag_file_use)">
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200201/ri_room_calibration_filter.bag" /> --> <!-- stable version-->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200201/ri_room_odometry_1_filter_filter.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200201/ri_room_odometry_2_filter.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200201/ri_room_odometry_3_wo_gt_filter.bag" /> -->

        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200207/ri_room_calibration_circle.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200207/ri_room_calibration_eight.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200207/ri_room_calibration_5_filter.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200207/ri_room_calibration_5_filter_filter.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200207/ri_room_with_loop.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200207/ri_room_with_loop.bag" /> -->

        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/20190809/room1.bag" /> -->

        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200228/ri_room_calib_filter.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200228/ri_room_loop_filter.bag" />  -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200228/ri_room_loop_test_vibration.bag" />  -->

        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200303/room_eight.bag" />  -->
        <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200303/room_rect.bag" /> 
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200303/room_loop_front.bag" />  -->
        <!--<arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200303/room_loop_back.bag" /> -->

        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200310/ri_room_loop_2.bag" /> -->
        <!-- <arg name="bag_file" default="/Monster/dataset/lidar_calibration/rhd_20200310/ri_room_loop_2_filter.bag" /> -->
        <node pkg="rosbag" type="play" name="rosbag" args="--clock --pause -r 1 $(arg bag_file)" />
    </group>

    <group if="$(arg run_mloam)">
        <node pkg="mloam" type="mloam_node_rhd" name="mloam_node_rhd" 
            args="$(arg config_file) $(arg mloam_result_save) $(arg output_path) $(arg mloam_odom_path) $(arg mloam_gt_path)">
            <remap from="/base_pose_gt" to="/Robot_2/pose"/>
        </node>

        <group if="$(arg run_mloam_map_with_up)">
            <node pkg="mloam" type="lidar_mapper" name="lidar_mapper" 
                args="$(arg config_file) $(arg mloam_result_save) $(arg output_path) $(arg mloam_map_path) 1" output="screen"/>
        </group>
        <group unless="$(arg run_mloam_map_with_up)">
            <node pkg="mloam" type="lidar_mapper" name="lidar_mapper" 
                args="$(arg config_file) $(arg mloam_result_save) $(arg output_path) $(arg mloam_map_wo_up_path) 0" output="screen"/>        
        </group>
    </group>

    <!-- publish static tf -->
    <!-- x y z yaw pitch roll -->
    <!-- x y z qx qy qz qw -->
    <node name="static_tf_world_base_into_world_sensor" pkg="tf" type="static_transform_publisher"
        args="0 0 0 -0.233 0 0 0.972 world_base world 10"/>
    <node name="static_tf_world_sensor_into_base_sensor" pkg="tf" type="static_transform_publisher"
        args="0 0 0 0 0 0 1 world laser_0 10"/>
    <node name="static_tf_laser_into_laser_left" pkg="tf" type="static_transform_publisher"
        args="0 0 0 0 0 0 1 laser_0 velo_left 10"/>        
    <node name="static_tf_laser_into_laser_right" pkg="tf" type="static_transform_publisher"
        args="0 0 0 0 0 0 1 laser_1 velo_right 10"/>                

    <!-- merge cloud -->
    <group unless="$(arg run_mloam)">
        <node pkg="mloam" type="test_merge_pointcloud_rhd" name="test_merge_pointcloud_rhd" output="screen" />      
        <node name="static_tf_world_sensor_into_camera" pkg="tf" type="static_transform_publisher"
            args="0 0 0 0 0 0 1 world camera_init 10"/>            
    </group>

    <!-- run aloam  -->
    <group if="$(arg run_aloam)">
        <include file="$(find aloam_velodyne)/launch/aloam_exp.launch">
            <arg name="aloam_odom_path" default="/home/jjiao/trajectory_results/handheld/test/mloam_20200303/RHD03building/stamped_aloam_odom_estimate.txt" />
            <arg name="aloam_map_path" default="/home/jjiao/trajectory_results/handheld/test/mloam_20200303/RHD03building/stamped_aloam_map_estimate.txt" />
        </include>       
    </group>        

    <!-- run legoloam  -->
    <group if="$(arg run_legoloam)">
        <include file="$(find lego_loam)/launch/legoloam_exp.launch">
            <arg name="lego_loam_odom_path" default="/home/jjiao/trajectory_results/handheld/test/mloam_20200303/RHD03building/stamped_legoloam_odom_estimate.txt" />
            <arg name="lego_loam_map_path" default="/home/jjiao/trajectory_results/handheld/test/mloam_20200303/RHD03building/stamped_legoloam_map_estimate.txt" />
        </include>
    </group>         

 </launch>
